<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hapoel Tel Aviv Goal Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        table { width: 90%; margin: 20px auto; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 10px; text-align: center; }
        th { background-color: red; color: white; }
        img.team-logo { max-width: 80px; border-radius: 10px; }
        .match-pics img { max-width: 400px; height: auto; border-radius: 10px; margin: 10px; }
        .hidden { display: none; }
        .expand-btn { cursor: pointer; font-weight: bold; color: blue; text-decoration: underline; }
    </style>
</head>
<body>
    <h1>‚öΩ Hapoel Tel Aviv Goal Tracker ‚öΩ</h1>
    <h3>Click on a match for more details!</h3>

    <!-- Table for Match Results -->
    <table id="matchResults">
        <thead>
            <tr>
                <th>Date</th>
                <th>Team A</th>
                <th>Team A Logo</th>
                <th>Team B</th>
                <th>Team B Logo</th>
                <th>Team A Score</th>
                <th>Team B Score</th>
                <th>More Info</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- ‚úÖ JavaScript for Loading Data and Expanding Rows -->
    <script>
        const googleSheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQLP3NhY3OCbw3X5Ry0jGfTWQRUW1BQxYX8wia8C_zXWalYQiak1MkPiqbIEFBHJONej08svc5T9j5q/pub?output=csv";

        async function loadMatchData() {
            try {
                // ‚úÖ Cache Bypass and Fetching CSV
                const timestamp = new Date().getTime(); 
                const csvURL = `${googleSheetURL}&cacheBuster=${timestamp}`;
                const response = await fetch(csvURL);
                const data = await response.text();
                
                // ‚úÖ Safer CSV Parsing
                const rows = data.split("\n").map(row => {
                    return row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
                });
                
                const tbody = document.querySelector("#matchResults tbody");
                tbody.innerHTML = "";

                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (row.length > 1) {
                        const tr = document.createElement("tr");

                        // ‚úÖ Display Standard Match Info
                        for (let j = 0; j < 7; j++) {
                            const td = document.createElement("td");

                            if (j === 2 || j === 4) {
                                const img = document.createElement("img");
                                img.src = row[j].trim();
                                img.alt = "Team Logo";
                                img.classList.add("team-logo");
                                td.appendChild(img);
                            } else {
                                td.textContent = row[j];
                            }
                            tr.appendChild(td);
                        }

                        // ‚úÖ Expand Button
                        const expandTd = document.createElement("td");
                        expandTd.innerHTML = '<span class="expand-btn" onclick="toggleDetails(this)">‚ûï More Info</span>';
                        tr.appendChild(expandTd);
                        tbody.appendChild(tr);

                        // ‚úÖ Hidden Row for Pictures and Note
                        const detailRow = document.createElement("tr");
                        detailRow.classList.add("hidden");
                        const detailTd = document.createElement("td");
                        detailTd.setAttribute("colspan", "8");

                        const imgContainer = document.createElement("div");
                        imgContainer.classList.add("match-pics");
                        const imageUrls = row[8].split(",");
                        imageUrls.forEach(url => {
                            const img = document.createElement("img");
                            img.src = url.trim();
                            img.alt = "Match Picture";
                            imgContainer.appendChild(img);
                        });

                        const note = document.createElement("p");
                        note.innerText = `üìù Note: ${row[9]}`;
                        detailTd.appendChild(imgContainer);
                        detailTd.appendChild(note);
                        detailRow.appendChild(detailTd);
                        tbody.appendChild(detailRow);
                    }
                }
            } catch (error) {
                console.error("Error loading data:", error);
            }
        }

        function toggleDetails(element) {
            const row = element.closest("tr").nextElementSibling;
            row.classList.toggle("hidden");
        }
        window.onload = loadMatchData;
    </script>
</body>
</html>
